---
id: kubernetes
title: Kubernetes
pagination_prev: getting_started/intro
pagination_next: getting_started/health_check
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';


# Kubernetes Deployment

Before getting started, it is advised to read the [introduction](/unversioned/getting_started/introduction.mdx) page to understand the prerequisites and concepts for running CrowdSec.

## Requirements

- [kubectl](https://kubernetes.io/docs/tasks/tools/#kubectl)
- [Helm](https://helm.sh/docs/intro/install/)

Even if an installation could be possible without Helm, it's not supported for now.

## Helm Repository Installation

Add the CrowdSec helm repository to your Helm installation:

```bash
helm repo add crowdsec https://crowdsecurity.github.io/helm-charts
helm repo update
```

### Install Security Engine

Once the helm repository is added, first you need to write your crowdsec-values.yaml file. You can use the following example:

```yaml
# for raw logs format: json or cri (docker|containerd)
container_runtime: containerd
agent:
  # Specify each pod whose logs you want to process
  acquisition:
    # The namespace where the pod is located
    - namespace: traefik
      # The pod name
      podName: traefik-*
      # as in crowdsec configuration, we need to specify the program name to find a matching parser
      program: traefik
  env:
    - name: COLLECTIONS
      value: "crowdsecurity/traefik"
lapi:
  env:
    # To enroll the Security Engine to the console
    - name: ENROLL_KEY
      value: "<enroll-key>"
    - name: ENROLL_INSTANCE_NAME
      value: "my-k8s-cluster"
    - name: ENROLL_TAGS
      value: "k8s linux test"
```

If you want more information about the configuration, you can check the default [values.yaml](https://artifacthub.io/packages/helm/crowdsec/crowdsec#values)

Then, you can install the Security Engine with the following command:

```bash
# Create a namespace for crowdsec
kubectl create ns crowdsec
# Install the helm chart
helm install crowdsec crowdsec/crowdsec -n crowdsec -f crowdsec-values.yaml
```

Check the installation status:
```bash
kubectl -n crowdsec get pods
```

```bash title="Command Output"
NAME READY STATUS RESTARTS AGE
crowdsec-agent-kf9fr 1/1 Running 0 34s
crowdsec-lapi-777c469947-jbk9q 1/1 Running 0 34s
```

### A Word About Remediation Component

Installing the CrowdSec Engine as a local API and log processors is very useful
to detect aggressive behaviors, but no remediation action will be taken upon it.
To get remediation actions, one has to install remediation component. As of now
remediation can only happen at ingress level.

For now, we support:

* [Ingress Nginx](u/bouncers/ingress-nginx/)
* [Traefik Kubernetes Ingress (Third party development)](https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin)

Before installing the remediation component, you need to generate API key to communicate with the LAPI.

:::info
If you **have persistentVolumes enabled** in `values.yaml`, you can generate the api key directly from the LAPI pod:

```bash
kubectl -n crowdsec exec -it crowdsec-lapi-<pod-id> -- cscli bouncers add my-bouncer-name
```

Else you **don't have persistentVolumes enabled**, you need to specify your key
in the crowdsec helm `values.yaml` file:

```yaml
lapi:
  env:
    - name: BOUNCER_KEY_<name>
      value: "<bouncer-key>"
```
example:
```yaml
lapi:
  env:
    - name: BOUNCER_KEY_traefik
      value: "mysecretkey12345"
```
:::


## Next Steps?

Great, you now have CrowdSec installed on your system. Within the [post
installation steps](/getting_started/next_steps.mdx) you will find the next
steps to configure and optimize your installation.
